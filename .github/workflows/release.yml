name: win32 binaries

on:  
  push:
    tags:
      - 'v*'
      
jobs:
  go-release-win-32:
    name: "Publish win32 Binaries"
    runs-on: ['Windows', 'self-hosted']
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Setup .NET
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: 7.0.x
    - name: Use Node.js 18.x
      uses: actions/setup-node@v3
      with:
        node-version: 18.x
    - name: Add nuget package source 
      continue-on-error: true  #ignore error (package source already present on the runner)
      run: dotnet nuget add source https://nuget.pkg.github.com/haga-rak/index.json -n nuget-fluxy -u haga-rak -p ${{ secrets.TOKEN_FOR_NUGET }}
    - name: Installing npm dependencies 
      working-directory: ./src/Fluxzy.Desktop.Ui/ClientApp
      run: npm install
    - name: Build executable 
      working-directory: ./src/Fluxzy.Desktop.Ui/ClientApp
      run: npm run package-win
    - name: Build installer 
      working-directory: ./src/Fluxzy.Desktop.Ui/ClientApp
      run: npm run make
    - name: Build installer 
      env:
        RELEASE_SERVER_PASSWORD:  ${{ secrets.RELEASE_SERVER_PASSWORD }}
      working-directory: ./src/Fluxzy.Desktop.Ui/ClientApp
      run: npm run publish


          
